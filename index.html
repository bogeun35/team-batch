<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÌåÄ Ìé∏ÏÑ± ÌîÑÎ°úÍ∑∏Îû®</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            flex: 1;
            min-width: 150px;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-balanced {
            background: #ed8936;
            color: white;
        }

        .btn-spectator {
            background: #805ad5;
            color: white;
        }

        .btn-auction {
            background: #d53f8c;
            color: white;
        }

        .btn-secondary {
            background: #f56565;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
        }

        .teams-container {
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .teams-grid {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 30px;
            align-items: start;
            margin-bottom: 30px;
        }

        .team {
            background: #2d3748;
            border-radius: 12px;
            padding: 20px;
        }

        .team-header {
            color: white;
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 3px solid #4a5568;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .team-score {
            font-size: 0.7em;
            background: rgba(255,255,255,0.2);
            padding: 5px 10px;
            border-radius: 15px;
        }

        .team-points {
            font-size: 0.6em;
            background: #d53f8c;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            margin-left: 10px;
        }

        .team-slots {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .team-slot {
            background: #4a5568;
            padding: 15px;
            border-radius: 8px;
            min-height: 50px;
            color: #a0aec0;
            font-style: italic;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            position: relative;
        }

        .team-slot.drag-over {
            background: #667eea;
            border: 2px dashed white;
            transform: scale(1.02);
        }

        .team-slot.empty::after {
            content: 'ÎπÑÏñ¥ ÏûàÏùå';
            color: #a0aec0;
            font-style: italic;
        }

        .player-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            cursor: move;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s;
            user-select: none;
            width: 100%;
        }

        .player-card:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

        .player-card.dragging {
            opacity: 0.3;
        }

        .player-card .tier-label {
            font-size: 0.8em;
            background: rgba(255,255,255,0.3);
            padding: 2px 8px;
            border-radius: 10px;
            display: inline-block;
            margin-top: 5px;
        }

        .player-card .role-label {
            font-size: 0.7em;
            background: rgba(255,255,255,0.5);
            padding: 2px 6px;
            border-radius: 8px;
            display: inline-block;
            margin-top: 3px;
        }

        .vs-divider {
            font-size: 3em;
            font-weight: bold;
            color: #2d3748;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .score-diff {
            font-size: 0.4em;
            background: #edf2f7;
            padding: 10px 15px;
            border-radius: 10px;
            color: #2d3748;
        }

        .score-diff.balanced {
            background: #c6f6d5;
            color: #22543d;
        }

        .spectators {
            background: #2d3748;
            border-radius: 12px;
            padding: 20px;
        }

        .spectators-header {
            color: white;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .spectator-count {
            font-size: 0.7em;
            background: rgba(255,255,255,0.2);
            padding: 5px 10px;
            border-radius: 15px;
        }

        .spectators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            min-height: 60px;
        }

        .spectators-grid.drag-over {
            background: rgba(102, 126, 234, 0.2);
            border: 2px dashed rgba(102, 126, 234, 0.5);
            border-radius: 8px;
        }

        .spectators-grid.empty::after {
            content: 'Í¥ÄÏ†ÑÏûê ÏóÜÏùå (ÏïÑÎûòÏóêÏÑú ÏÑ†ÌÉù)';
            color: #a0aec0;
            font-style: italic;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 60px;
        }

        .spectator-card {
            background: linear-gradient(135deg, #805ad5 0%, #6b46c1 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            cursor: move;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s;
            user-select: none;
            position: relative;
        }

        .spectator-card:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

        .spectator-card.dragging {
            opacity: 0.3;
        }

        .spectator-card.auction-current {
            background: linear-gradient(135deg, #f6ad55 0%, #ed8936 100%);
            box-shadow: 0 0 20px rgba(237, 137, 54, 0.6);
            transform: scale(1.1);
        }

        .spectator-card .tier-label {
            font-size: 0.8em;
            background: rgba(255,255,255,0.3);
            padding: 2px 8px;
            border-radius: 10px;
            display: inline-block;
            margin-top: 5px;
        }

        .spectator-card .role-label {
            font-size: 0.7em;
            background: rgba(255,255,255,0.5);
            padding: 2px 6px;
            border-radius: 8px;
            display: inline-block;
            margin-top: 3px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .spectator-card .role-label:hover {
            background: rgba(255,255,255,0.7);
            transform: scale(1.1);
        }

        .spectator-card .remove-spectator-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(239, 68, 68, 0.8);
            border: none;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            z-index: 10;
        }

        .spectator-card .remove-spectator-btn:hover {
            background: #dc2626;
            transform: scale(1.1);
        }

        .player-list-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .template-section {
            background: #f0f4ff;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .template-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .template-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .template-btn {
            padding: 8px 16px;
            border: 2px solid #667eea;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            position: relative;
        }

        .template-btn:hover {
            background: #667eea;
            color: white;
        }

        .template-btn.active {
            background: #667eea;
            color: white;
        }

        .template-actions {
            display: flex;
            gap: 8px;
        }

        .template-action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .template-action-btn.save {
            background: #48bb78;
            color: white;
        }

        .template-action-btn.rename {
            background: #ed8936;
            color: white;
        }

        .template-action-btn:hover {
            transform: translateY(-2px);
        }

        .player-input-section {
            background: #f7fafc;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .player-input-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .saved-players {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .saved-player-tag {
            background: #667eea;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            user-select: none;
        }

        .saved-player-tag.selectable {
            cursor: pointer;
        }

        .saved-player-tag.selectable:hover {
            background: #5568d3;
            transform: scale(1.05);
        }

        .saved-player-tag.in-spectator {
            background: #805ad5;
            cursor: default;
        }

        .saved-player-tag.in-team {
            background: #718096;
            opacity: 0.7;
            cursor: default;
        }

        .saved-player-tag .tier-badge {
            background: rgba(255,255,255,0.3);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .saved-player-tag .tier-badge:hover {
            background: rgba(255,255,255,0.5);
            transform: scale(1.1);
        }

        .saved-player-tag .remove-btn {
            background: rgba(255,255,255,0.3);
            border: none;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .saved-player-tag .remove-btn:hover {
            background: rgba(255,255,255,0.5);
        }

        .add-player-section {
            display: grid;
            gap: 10px;
            margin-bottom: 10px;
        }

        .input-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .player-name-input {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .tier-input {
            width: 70px;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            text-align: center;
        }

        .tier-input-label {
            font-size: 14px;
            color: #666;
            white-space: nowrap;
        }

        .add-player-btn {
            padding: 10px 20px;
            background: #48bb78;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .add-player-btn:hover {
            background: #38a169;
            transform: translateY(-2px);
        }

        .info-message {
            background: #edf2f7;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
            color: #4a5568;
        }

        /* Î™®Îã¨ Í≥µÌÜµ Ïä§ÌÉÄÏùº */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            max-width: 300px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 20px;
            color: #2d3748;
            text-align: center;
        }

        .modal-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 1.2em;
            text-align: center;
            margin-bottom: 20px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-btn.save {
            background: #48bb78;
            color: white;
        }

        .modal-btn.cancel {
            background: #e2e8f0;
            color: #4a5568;
        }

        .modal-btn:hover {
            transform: translateY(-2px);
        }

        /* Ïó≠Ìï† ÏÑ†ÌÉù Î™®Îã¨ */
        .role-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .role-option {
            padding: 20px;
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            font-size: 1.2em;
            transition: all 0.3s;
        }

        .role-option:hover {
            background: #edf2f7;
            transform: scale(1.05);
        }

        .role-option.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* Í≤ΩÎß§ Î™®Îã¨ */
        .auction-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .auction-modal.active {
            display: flex;
        }

        .auction-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .auction-player {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #f6ad55 0%, #ed8936 100%);
            border-radius: 12px;
            margin-bottom: 20px;
            color: white;
        }

        .auction-player-name {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .auction-player-info {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .auction-player-tier {
            font-size: 1.2em;
            background: rgba(255,255,255,0.3);
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
        }

        .auction-player-role {
            font-size: 1.2em;
            background: rgba(255,255,255,0.5);
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
        }

        .auction-timer {
            text-align: center;
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #f6ad55 0%, #ed8936 100%);
            border-radius: 15px;
            color: white;
            transition: all 0.3s;
        }

        .auction-timer.warning {
            background: linear-gradient(135deg, #fc8181 0%, #f56565 100%);
            animation: pulse 0.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .auction-points-config {
            background: #fff5f5;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .auction-points-inputs {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .auction-points-input-group {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .auction-points-input-group label {
            font-weight: bold;
            color: #2d3748;
        }

        .auction-points-input-group input {
            flex: 1;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            text-align: center;
        }

        .auction-status {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
        }

        .auction-team {
            flex: 1;
            text-align: center;
            padding: 20px;
            background: #f7fafc;
            border-radius: 10px;
            margin: 0 10px;
            transition: all 0.3s;
        }

        .auction-team.last-bid {
            background: #c6f6d5;
            border: 3px solid #48bb78;
        }

        .auction-team-name {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2d3748;
        }

        .auction-team-points {
            font-size: 1.5em;
            color: #d53f8c;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .auction-bid-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1.1em;
            text-align: center;
            margin-bottom: 10px;
        }

        .auction-bid-btn {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .auction-bid-btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .auction-bid-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
        }

        .auction-current-bid {
            text-align: center;
            font-size: 1.3em;
            margin-bottom: 20px;
            padding: 15px;
            background: #edf2f7;
            border-radius: 10px;
        }

        .auction-winner {
            color: #48bb78;
            font-weight: bold;
        }

        .auction-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .auction-pass-btn {
            flex: 1;
            padding: 15px;
            background: #ed8936;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .auction-pass-btn:hover {
            background: #dd6b20;
        }

        .auction-next-btn {
            flex: 1;
            padding: 15px;
            background: #48bb78;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .auction-next-btn:hover {
            background: #38a169;
        }

        .auction-close-btn {
            padding: 15px 30px;
            background: #f56565;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .auction-close-btn:hover {
            background: #e53e3e;
        }

        @media (max-width: 968px) {
            .teams-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .vs-divider {
                transform: rotate(90deg);
                margin: 20px 0;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .spectators-grid {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-wrap: wrap;
            }

            .btn {
                min-width: calc(50% - 5px);
            }

            .auction-status {
                flex-direction: column;
            }

            .auction-team {
                margin: 10px 0;
            }

            .auction-points-inputs {
                flex-direction: column;
            }

            .input-row {
                flex-wrap: wrap;
            }

            .template-buttons {
                width: 100%;
            }

            .template-btn {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öΩ ÌåÄ Ìé∏ÏÑ± ÌîÑÎ°úÍ∑∏Îû®</h1>
        </div>

        <div class="controls">
            <div class="action-buttons">
                <button class="btn btn-balanced" id="balancedBtn">‚öñÔ∏è Î∞∏Îü∞Ïä§ ÎûúÎç§</button>
                <button class="btn btn-spectator" id="spectatorRandomBtn">üë• Í¥ÄÏ†ÑÏûê ÎûúÎç§</button>
                <button class="btn btn-auction" id="auctionBtn">üî® Í≤ΩÎß§ÌïòÍ∏∞</button>
                <button class="btn btn-secondary" id="clearTeamsBtn">üîÑ Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî</button>
            </div>
        </div>

        <div class="teams-container">
            <div class="teams-grid">
                <div class="team">
                    <div class="team-header">
                        <span>1ÌåÄ</span>
                        <div>
                            <span class="team-score" id="team1Score">0Ï†ê</span>
                            <span class="team-points" id="team1Points">100P</span>
                        </div>
                    </div>
                    <div class="team-slots" id="team1"></div>
                </div>

                <div class="vs-divider">
                    <div>VS</div>
                    <div class="score-diff" id="scoreDiff">Ï†êÏàòÏ∞®: 0</div>
                </div>

                <div class="team">
                    <div class="team-header">
                        <span>2ÌåÄ</span>
                        <div>
                            <span class="team-score" id="team2Score">0Ï†ê</span>
                            <span class="team-points" id="team2Points">100P</span>
                        </div>
                    </div>
                    <div class="team-slots" id="team2"></div>
                </div>
            </div>

            <div class="spectators">
                <div class="spectators-header">
                    <span>üë• Í¥ÄÏ†ÑÏûê</span>
                    <span class="spectator-count" id="spectatorCount">0Î™Ö</span>
                </div>
                <div class="spectators-grid empty" id="spectatorsGrid"></div>
            </div>
        </div>

        <div class="player-list-container">
            <div class="player-input-section">
                <div class="player-input-header">
                    <label style="margin: 0;">Ï∞∏Í∞ÄÏûê Î™©Î°ù (ÌÅ¥Î¶≠ÌïòÏó¨ Í¥ÄÏ†ÑÏûêÎ°ú Ï∂îÍ∞Ä)</label>
                </div>
                
                <div class="saved-players" id="savedPlayers">
                    <span style="color: #a0aec0;">Ï†ÄÏû•Îêú Ï∞∏Í∞ÄÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§</span>
                </div>

                <div class="add-player-section">
                    <div class="input-row">
                        <input type="text" class="player-name-input" id="newPlayerInput" placeholder="ÏÉà Ï∞∏Í∞ÄÏûê Ïù¥Î¶Ñ ÏûÖÎ†•">
                        <span class="tier-input-label">Ìã∞Ïñ¥:</span>
                        <input type="number" class="tier-input" id="newTierInput" value="3" min="1">
                        <button class="add-player-btn" id="addPlayerBtn">‚ûï Ï∂îÍ∞Ä</button>
                    </div>
                </div>
                
                <div class="info-message">
                    üí° Ï∞∏Í∞ÄÏûêÎ•º ÌÅ¥Î¶≠ÌïòÎ©¥ Í¥ÄÏ†ÑÏûêÏóê Ï∂îÍ∞ÄÎê©ÎãàÎã§. Í¥ÄÏ†ÑÏûêÏóêÏÑú Ïó≠Ìï†(ÌÉ±Ïª§/ÎîúÎü¨/ÌûêÎü¨/ÎûúÎç§)ÏùÑ ÏÑ†ÌÉùÌï† Ïàò ÏûàÏäµÎãàÎã§. ÌåÄ ÌÅ¨Í∏∞Îäî Í¥ÄÏ†ÑÏûê ÏàòÏóê Îî∞Îùº ÏûêÎèô Ï°∞Ï†ïÎê©ÎãàÎã§.
                </div>
            </div>

            <div class="template-section">
                <div class="template-header">
                    <label style="margin: 0;">Ï∞∏Í∞ÄÏûê ÌÖúÌîåÎ¶ø</label>
                    <div class="template-actions">
                        <button class="template-action-btn save" id="saveTemplateBtn">üíæ Ï†ÄÏû•</button>
                        <button class="template-action-btn rename" id="renameTemplateBtn">‚úèÔ∏è Ïù¥Î¶ÑÎ≥ÄÍ≤Ω</button>
                    </div>
                </div>
                <div class="template-buttons" id="templateButtons"></div>
            </div>
        </div>
    </div>

    <!-- Ìã∞Ïñ¥ ÏàòÏ†ï Î™®Îã¨ -->
    <div class="modal" id="tierModal">
        <div class="modal-content">
            <div class="modal-title" id="tierModalTitle">Ìã∞Ïñ¥ ÏàòÏ†ï</div>
            <input type="number" class="modal-input" id="tierModalInput" min="1">
            <div class="modal-buttons">
                <button class="modal-btn cancel" id="tierModalCancel">Ï∑®ÏÜå</button>
                <button class="modal-btn save" id="tierModalSave">Ï†ÄÏû•</button>
            </div>
        </div>
    </div>

    <!-- Ïó≠Ìï† ÏÑ†ÌÉù Î™®Îã¨ -->
    <div class="modal" id="roleModal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-title" id="roleModalTitle">Ïó≠Ìï† ÏÑ†ÌÉù</div>
            <div class="role-selector">
                <div class="role-option" data-role="ÌÉ±Ïª§">üõ°Ô∏è<br>ÌÉ±Ïª§</div>
                <div class="role-option" data-role="ÎîúÎü¨">‚öîÔ∏è<br>ÎîúÎü¨</div>
                <div class="role-option" data-role="ÌûêÎü¨">‚ù§Ô∏è<br>ÌûêÎü¨</div>
                <div class="role-option" data-role="ÎûúÎç§">üé≤<br>ÎûúÎç§</div>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" id="roleModalCancel">Ï∑®ÏÜå</button>
                <button class="modal-btn save" id="roleModalSave">ÌôïÏù∏</button>
            </div>
        </div>
    </div>

    <!-- ÌÖúÌîåÎ¶ø Ïù¥Î¶Ñ ÏûÖÎ†• Î™®Îã¨ -->
    <div class="modal" id="templateNameModal">
        <div class="modal-content">
            <div class="modal-title" id="templateNameModalTitle">ÌÖúÌîåÎ¶ø Ïù¥Î¶Ñ</div>
            <input type="text" class="modal-input" id="templateNameInput" placeholder="ÌÖúÌîåÎ¶ø Ïù¥Î¶Ñ ÏûÖÎ†•">
            <div class="modal-buttons">
                <button class="modal-btn cancel" id="templateNameCancel">Ï∑®ÏÜå</button>
                <button class="modal-btn save" id="templateNameSave">Ï†ÄÏû•</button>
            </div>
        </div>
    </div>

    <!-- Í≤ΩÎß§ Î™®Îã¨ -->
    <div class="auction-modal" id="auctionModal">
        <div class="auction-content">
            <div class="auction-player">
                <div class="auction-player-name" id="auctionPlayerName">ÌîåÎ†àÏù¥Ïñ¥</div>
                <div class="auction-player-info">
                    <div class="auction-player-tier" id="auctionPlayerTier">3Ï†ê</div>
                    <div class="auction-player-role" id="auctionPlayerRole">ÎûúÎç§</div>
                </div>
            </div>

            <div class="auction-timer" id="auctionTimer">‚è±Ô∏è 6Ï¥à</div>

            <div class="auction-points-config">
                <div class="auction-points-inputs">
                    <div class="auction-points-input-group">
                        <label>1ÌåÄ:</label>
                        <input type="number" id="auctionTeam1PointsInput" min="0">
                    </div>
                    <div class="auction-points-input-group">
                        <label>2ÌåÄ:</label>
                        <input type="number" id="auctionTeam2PointsInput" min="0">
                    </div>
                </div>
            </div>

            <div class="auction-current-bid" id="auctionCurrentBid">
                ÌòÑÏû¨ ÏûÖÏ∞∞Í∞Ä: <span class="auction-winner">ÏóÜÏùå</span>
            </div>

            <div class="auction-status">
                <div class="auction-team" id="auctionTeam1">
                    <div class="auction-team-name">1ÌåÄ</div>
                    <div class="auction-team-points" id="auctionTeam1Points">100P</div>
                    <input type="number" class="auction-bid-input" id="team1BidInput" min="0" placeholder="ÏûÖÏ∞∞Í∞Ä ÏûÖÎ†•">
                    <button class="auction-bid-btn" id="team1BidBtn">ÏûÖÏ∞∞ÌïòÍ∏∞</button>
                </div>

                <div class="auction-team" id="auctionTeam2">
                    <div class="auction-team-name">2ÌåÄ</div>
                    <div class="auction-team-points" id="auctionTeam2Points">100P</div>
                    <input type="number" class="auction-bid-input" id="team2BidInput" min="0" placeholder="ÏûÖÏ∞∞Í∞Ä ÏûÖÎ†•">
                    <button class="auction-bid-btn" id="team2BidBtn">ÏûÖÏ∞∞ÌïòÍ∏∞</button>
                </div>
            </div>

            <div class="auction-controls">
                <button class="auction-pass-btn" id="auctionPassBtn">‚è≠Ô∏è Ïú†Ï∞∞ (Îí§Î°ú)</button>
                <button class="auction-next-btn" id="auctionNextBtn">Îã§Ïùå ÏÑ†Ïàò</button>
                <button class="auction-close-btn" id="auctionCloseBtn">Îã´Í∏∞</button>
            </div>
        </div>
    </div>

    <script>
        let savedPlayers = [];
        let draggedElement = null;
        let sourceContainer = null;
        let nextPlayerId = 1;
        let editingPlayerId = null;
        let editingSpectatorId = null;
        let selectedRole = null;
        
        let team1Points = 100;
        let team2Points = 100;
        let auctionPlayers = [];
        let currentAuctionIndex = 0;
        let currentBid = { team: null, amount: 0 };

        // ÌÉÄÏù¥Î®∏ Í¥ÄÎ†®
        let auctionTimer = null;
        let auctionTimeLeft = 6;

        // ÌÖúÌîåÎ¶ø Í¥ÄÎ†®
        let templates = [];
        let currentTemplateIndex = 0;
        const MAX_TEMPLATES = 5;

        const ROLE_ICONS = {
            'ÌÉ±Ïª§': 'üõ°Ô∏è',
            'ÎîúÎü¨': '‚öîÔ∏è',
            'ÌûêÎü¨': '‚ù§Ô∏è',
            'ÎûúÎç§': 'üé≤'
        };

        const STORAGE_KEY_TEMPLATES = 'teamDivider_templates';
        const STORAGE_KEY_CURRENT = 'teamDivider_currentTemplate';

        function init() {
            loadTemplates();
            updateTemplateButtons();
            loadCurrentTemplate();
            updateTeamSlots();
            updateSavedPlayersUI();
            setupEventListeners();
            setupSpectatorsDragDrop();
            updateTeamPoints();
        }

        function loadTemplates() {
            const saved = localStorage.getItem(STORAGE_KEY_TEMPLATES);
            if (saved) {
                try {
                    templates = JSON.parse(saved);
                } catch (e) {
                    templates = [];
                }
            }
            
            while (templates.length < MAX_TEMPLATES) {
                templates.push({
                    name: `ÌÖúÌîåÎ¶ø ${templates.length + 1}`,
                    players: [],
                    nextId: 1
                });
            }

            const savedCurrent = localStorage.getItem(STORAGE_KEY_CURRENT);
            if (savedCurrent !== null) {
                currentTemplateIndex = parseInt(savedCurrent);
            }
        }

        function saveTemplates() {
            localStorage.setItem(STORAGE_KEY_TEMPLATES, JSON.stringify(templates));
            localStorage.setItem(STORAGE_KEY_CURRENT, currentTemplateIndex.toString());
        }

        function loadCurrentTemplate() {
            const template = templates[currentTemplateIndex];
            savedPlayers = template.players || [];
            nextPlayerId = template.nextId || 1;
        }

        function saveCurrentTemplate() {
            templates[currentTemplateIndex].players = savedPlayers;
            templates[currentTemplateIndex].nextId = nextPlayerId;
            saveTemplates();
        }

        function switchTemplate(index) {
            saveCurrentTemplate();
            currentTemplateIndex = index;
            loadCurrentTemplate();
            updateTemplateButtons();
            updateSavedPlayersUI();
            clearAll();
            saveTemplates();
        }

        function updateTemplateButtons() {
            const container = document.getElementById('templateButtons');
            container.innerHTML = '';
            
            templates.forEach((template, index) => {
                const btn = document.createElement('button');
                btn.className = 'template-btn';
                if (index === currentTemplateIndex) {
                    btn.classList.add('active');
                }
                btn.textContent = template.name;
                btn.addEventListener('click', () => switchTemplate(index));
                container.appendChild(btn);
            });
        }

        function openTemplateNameModal(mode) {
            const modal = document.getElementById('templateNameModal');
            const input = document.getElementById('templateNameInput');
            const title = document.getElementById('templateNameModalTitle');
            
            if (mode === 'rename') {
                title.textContent = 'ÌÖúÌîåÎ¶ø Ïù¥Î¶Ñ Î≥ÄÍ≤Ω';
                input.value = templates[currentTemplateIndex].name;
            } else {
                title.textContent = 'ÌÖúÌîåÎ¶ø Ïù¥Î¶Ñ';
                input.value = templates[currentTemplateIndex].name;
            }
            
            modal.classList.add('active');
            input.focus();
            input.select();
        }

        function saveTemplateName() {
            const input = document.getElementById('templateNameInput');
            const newName = input.value.trim();
            
            if (newName === '') {
                alert('ÌÖúÌîåÎ¶ø Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }
            
            templates[currentTemplateIndex].name = newName;
            saveTemplates();
            updateTemplateButtons();
            
            document.getElementById('templateNameModal').classList.remove('active');
        }

        function updateTeamPoints() {
            document.getElementById('team1Points').textContent = `${team1Points}P`;
            document.getElementById('team2Points').textContent = `${team2Points}P`;
        }

        function getTeamPlayerNames() {
            const teamNames = new Set();
            const allSlots = document.querySelectorAll('.team-slot');
            
            allSlots.forEach(slot => {
                const card = slot.querySelector('.player-card');
                if (card) {
                    const player = JSON.parse(card.dataset.player);
                    teamNames.add(player.name);
                }
            });
            
            return teamNames;
        }

        function getSpectatorPlayerNames() {
            const spectatorNames = new Set();
            const spectatorsGrid = document.getElementById('spectatorsGrid');
            const cards = spectatorsGrid.querySelectorAll('.spectator-card');
            
            cards.forEach(card => {
                const player = JSON.parse(card.dataset.player);
                spectatorNames.add(player.name);
            });
            
            return spectatorNames;
        }

        function getEmptySlotCount() {
            const allSlots = document.querySelectorAll('.team-slot');
            let emptyCount = 0;
            
            allSlots.forEach(slot => {
                if (slot.classList.contains('empty') || !slot.querySelector('.player-card')) {
                    emptyCount++;
                }
            });
            
            return emptyCount;
        }

        function calculateTeamSize() {
            const spectatorCount = getSpectatorPlayers().length;
            
            // ÌåÄÏóê Ïù¥ÎØ∏ Î∞∞ÏπòÎêú Ïù∏Ïõê Ïàò Í≥ÑÏÇ∞
            const team1Slots = document.querySelectorAll('#team1 .team-slot');
            const team2Slots = document.querySelectorAll('#team2 .team-slot');
            
            let team1Count = 0;
            let team2Count = 0;
            
            team1Slots.forEach(slot => {
                if (slot.querySelector('.player-card')) {
                    team1Count++;
                }
            });
            
            team2Slots.forEach(slot => {
                if (slot.querySelector('.player-card')) {
                    team2Count++;
                }
            });
            
            // Ï†ÑÏ≤¥ Ï∞∏Í∞ÄÏûê Ïàò = Í¥ÄÏ†ÑÏûê + ÌåÄ1 + ÌåÄ2
            const totalPlayers = spectatorCount + team1Count + team2Count;
            
            // Ï†ÑÏ≤¥ Ïù∏ÏõêÏùÑ 2Î°ú ÎÇòÎàà Í∞íÏùÑ Ïò¨Î¶º
            return Math.ceil(totalPlayers / 2);
        }

        // ÌÉÄÏù¥Î®∏ ÏãúÏûë
        function startAuctionTimer() {
            stopAuctionTimer(); // Í∏∞Ï°¥ ÌÉÄÏù¥Î®∏ Ï†ïÎ¶¨
            auctionTimeLeft = 6;
            updateTimerDisplay();
            
            auctionTimer = setInterval(() => {
                auctionTimeLeft--;
                updateTimerDisplay();
                
                if (auctionTimeLeft <= 0) {
                    stopAuctionTimer();
                }
            }, 1000);
        }

        // ÌÉÄÏù¥Î®∏ Ï§ëÏßÄ
        function stopAuctionTimer() {
            if (auctionTimer) {
                clearInterval(auctionTimer);
                auctionTimer = null;
            }
        }

        // ÌÉÄÏù¥Î®∏ Î¶¨ÏÖã (ÏûÖÏ∞∞/Ïú†Ï∞∞/Îã§Ïùå ÏÑ†Ïàò Ïãú)
        function resetAuctionTimer() {
            startAuctionTimer();
        }

        // ÌÉÄÏù¥Î®∏ ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
        function updateTimerDisplay() {
            const timerElement = document.getElementById('auctionTimer');
            timerElement.textContent = `‚è±Ô∏è ${auctionTimeLeft}Ï¥à`;
            
            if (auctionTimeLeft <= 3) {
                timerElement.classList.add('warning');
            } else {
                timerElement.classList.remove('warning');
            }
        }

        function setupSpectatorsDragDrop() {
            const spectatorsGrid = document.getElementById('spectatorsGrid');
            
            spectatorsGrid.addEventListener('dragover', handleSpectatorDragOver);
            spectatorsGrid.addEventListener('drop', handleSpectatorDrop);
            spectatorsGrid.addEventListener('dragleave', handleSpectatorDragLeave);
            spectatorsGrid.addEventListener('dragenter', handleSpectatorDragEnter);
        }

        function handleSpectatorDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleSpectatorDragEnter(e) {
            e.currentTarget.classList.add('drag-over');
        }

        function handleSpectatorDragLeave(e) {
            if (e.target === e.currentTarget) {
                e.currentTarget.classList.remove('drag-over');
            }
        }

        function handleSpectatorDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            if (e.preventDefault) {
                e.preventDefault();
            }
            
            const spectatorsGrid = document.getElementById('spectatorsGrid');
            spectatorsGrid.classList.remove('drag-over');
            
            if (!draggedElement || !sourceContainer) {
                return false;
            }
            
            const player = JSON.parse(draggedElement.dataset.player);
            
            if (sourceContainer.classList.contains('team-slot')) {
                sourceContainer.innerHTML = '';
                sourceContainer.classList.add('empty');
                
                addToSpectators(player);
                updateTeamScores();
                updateSpectatorCount();
                updateSavedPlayersUI();
                updateTeamSlots();
            }
            
            return false;
        }

        function addToSpectators(player) {
            const spectatorsGrid = document.getElementById('spectatorsGrid');
            
            const spectatorNames = getSpectatorPlayerNames();
            if (spectatorNames.has(player.name)) {
                return;
            }
            
            spectatorsGrid.classList.remove('empty');
            const card = createSpectatorCard(player);
            spectatorsGrid.appendChild(card);
        }

        function createSpectatorCard(player) {
            const card = document.createElement('div');
            card.className = 'spectator-card';
            card.innerHTML = `
                <button class="remove-spectator-btn" title="Í¥ÄÏ†ÑÏûêÏóêÏÑú Ï†úÏô∏">‚úï</button>
                ${player.name}
                <div class="tier-label">${player.tier}Ï†ê</div>
                <div class="role-label">${ROLE_ICONS[player.role]} ${player.role}</div>
            `;
            card.draggable = true;
            card.dataset.player = JSON.stringify(player);
            
            card.addEventListener('dragstart', handleDragStart);
            card.addEventListener('dragend', handleDragEnd);
            
            const removeBtn = card.querySelector('.remove-spectator-btn');
            removeBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                removeFromSpectators(player);
            });

            const roleLabel = card.querySelector('.role-label');
            roleLabel.addEventListener('click', (e) => {
                e.stopPropagation();
                openRoleModal(player);
            });
            
            return card;
        }

        function openRoleModal(player) {
            editingSpectatorId = player.id;
            selectedRole = player.role;
            
            document.getElementById('roleModalTitle').textContent = `${player.name} Ïó≠Ìï† ÏÑ†ÌÉù`;
            
            document.querySelectorAll('.role-option').forEach(opt => {
                opt.classList.remove('selected');
                if (opt.dataset.role === player.role) {
                    opt.classList.add('selected');
                }
            });
            
            document.getElementById('roleModal').classList.add('active');
        }

        function saveRoleChange() {
            if (!selectedRole) {
                alert('Ïó≠Ìï†ÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }

            const spectatorsGrid = document.getElementById('spectatorsGrid');
            const cards = spectatorsGrid.querySelectorAll('.spectator-card');
            
            cards.forEach(card => {
                const player = JSON.parse(card.dataset.player);
                if (player.id === editingSpectatorId) {
                    player.role = selectedRole;
                    card.dataset.player = JSON.stringify(player);
                    card.querySelector('.role-label').innerHTML = `${ROLE_ICONS[player.role]} ${player.role}`;
                }
            });
            
            document.getElementById('roleModal').classList.remove('active');
            editingSpectatorId = null;
            selectedRole = null;
        }

        function removeFromSpectators(player) {
            const spectatorsGrid = document.getElementById('spectatorsGrid');
            const cards = spectatorsGrid.querySelectorAll('.spectator-card');
            
            cards.forEach(card => {
                const cardPlayer = JSON.parse(card.dataset.player);
                if (cardPlayer.id === player.id) {
                    card.remove();
                }
            });
            
            updateSpectatorCount();
            updateSavedPlayersUI();
            updateTeamSlots();
        }

        function updateSpectatorCount() {
            const spectatorsGrid = document.getElementById('spectatorsGrid');
            const count = spectatorsGrid.querySelectorAll('.spectator-card').length;
            document.getElementById('spectatorCount').textContent = `${count}Î™Ö`;
            
            if (count === 0) {
                spectatorsGrid.classList.add('empty');
            } else {
                spectatorsGrid.classList.remove('empty');
            }
        }

        function setupEventListeners() {
            document.getElementById('addPlayerBtn').addEventListener('click', addPlayer);
            document.getElementById('newPlayerInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addPlayer();
                }
            });
            document.getElementById('newTierInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addPlayer();
                }
            });

            document.getElementById('balancedBtn').addEventListener('click', balancedRandomAssign);
            document.getElementById('spectatorRandomBtn').addEventListener('click', spectatorRandomAssign);
            document.getElementById('auctionBtn').addEventListener('click', startAuction);
            document.getElementById('clearTeamsBtn').addEventListener('click', clearAll);

            document.getElementById('team1BidBtn').addEventListener('click', () => placeBid(1));
            document.getElementById('team2BidBtn').addEventListener('click', () => placeBid(2));
            document.getElementById('auctionPassBtn').addEventListener('click', passAuction);
            document.getElementById('auctionNextBtn').addEventListener('click', nextAuctionPlayer);
            document.getElementById('auctionCloseBtn').addEventListener('click', closeAuction);

            // ÏûÖÏ∞∞ ÏûÖÎ†• Î∞ïÏä§ÏóêÏÑú ÏóîÌÑ∞ ÌÇ§ Ïù¥Î≤§Ìä∏
            document.getElementById('team1BidInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    placeBid(1);
                }
            });

            document.getElementById('team2BidInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    placeBid(2);
                }
            });

            // Í≤ΩÎß§ Ìè¨Ïù∏Ìä∏ ÏûÖÎ†• Î∞ïÏä§ Î≥ÄÍ≤Ω Ïãú ÏûêÎèô ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('auctionTeam1PointsInput').addEventListener('input', function() {
                team1Points = parseInt(this.value) || 0;
                updateTeamPoints();
                document.getElementById('auctionTeam1Points').textContent = `${team1Points}P`;
            });

            document.getElementById('auctionTeam2PointsInput').addEventListener('input', function() {
                team2Points = parseInt(this.value) || 0;
                updateTeamPoints();
                document.getElementById('auctionTeam2Points').textContent = `${team2Points}P`;
            });

            // Ìã∞Ïñ¥ Î™®Îã¨
            document.getElementById('tierModalCancel').addEventListener('click', closeTierModal);
            document.getElementById('tierModalSave').addEventListener('click', saveTierChange);
            document.getElementById('tierModalInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    saveTierChange();
                }
            });

            // Ïó≠Ìï† Î™®Îã¨
            document.querySelectorAll('.role-option').forEach(opt => {
                opt.addEventListener('click', function() {
                    document.querySelectorAll('.role-option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedRole = this.dataset.role;
                });
            });
            document.getElementById('roleModalCancel').addEventListener('click', () => {
                document.getElementById('roleModal').classList.remove('active');
                editingSpectatorId = null;
                selectedRole = null;
            });
            document.getElementById('roleModalSave').addEventListener('click', saveRoleChange);

            // ÌÖúÌîåÎ¶ø Î≤ÑÌäº
            document.getElementById('saveTemplateBtn').addEventListener('click', () => {
                saveCurrentTemplate();
                alert('ÌòÑÏû¨ ÌÖúÌîåÎ¶øÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!');
            });
            document.getElementById('renameTemplateBtn').addEventListener('click', () => {
                openTemplateNameModal('rename');
            });

            // ÌÖúÌîåÎ¶ø Ïù¥Î¶Ñ Î™®Îã¨
            document.getElementById('templateNameCancel').addEventListener('click', () => {
                document.getElementById('templateNameModal').classList.remove('active');
            });
            document.getElementById('templateNameSave').addEventListener('click', saveTemplateName);
            document.getElementById('templateNameInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    saveTemplateName();
                }
            });
        }

        function addPlayer() {
            const input = document.getElementById('newPlayerInput');
            const tierInput = document.getElementById('newTierInput');
            const name = input.value.trim();
            
            const tier = parseInt(tierInput.value) || 3;

            if (name === '') {
                alert('Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }

            if (tier < 1) {
                alert('Ìã∞Ïñ¥Îäî 1 Ïù¥ÏÉÅÏù¥Ïñ¥Ïïº Ìï©ÎãàÎã§!');
                return;
            }

            const newPlayer = {
                id: nextPlayerId++,
                name,
                tier,
                role: 'ÎûúÎç§'
            };

            savedPlayers.push(newPlayer);
            saveCurrentTemplate();
            input.value = '';
            tierInput.value = '3';
            
            updateSavedPlayersUI();
        }

        function removePlayer(id) {
            const player = savedPlayers.find(p => p.id === id);
            if (!player) return;
            
            if (confirm(`"${player.name} (${player.tier}Ï†ê)"ÏùÑ(Î•º) Î™©Î°ùÏóêÏÑú ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                savedPlayers = savedPlayers.filter(p => p.id !== id);
                
                const spectatorsGrid = document.getElementById('spectatorsGrid');
                const cards = spectatorsGrid.querySelectorAll('.spectator-card');
                cards.forEach(card => {
                    const cardPlayer = JSON.parse(card.dataset.player);
                    if (cardPlayer.id === id) {
                        card.remove();
                    }
                });
                
                const allSlots = document.querySelectorAll('.team-slot');
                allSlots.forEach(slot => {
                    const card = slot.querySelector('.player-card');
                    if (card) {
                        const cardPlayer = JSON.parse(card.dataset.player);
                        if (cardPlayer.id === id) {
                            slot.innerHTML = '';
                            slot.classList.add('empty');
                        }
                    }
                });
                
                saveCurrentTemplate();
                updateSavedPlayersUI();
                updateSpectatorCount();
                updateTeamScores();
                updateTeamSlots();
            }
        }

        function openTierModal(player) {
            editingPlayerId = player.id;
            document.getElementById('tierModalTitle').textContent = `${player.name} Ìã∞Ïñ¥ ÏàòÏ†ï`;
            document.getElementById('tierModalInput').value = player.tier;
            document.getElementById('tierModal').classList.add('active');
            document.getElementById('tierModalInput').focus();
            document.getElementById('tierModalInput').select();
        }

        function closeTierModal() {
            document.getElementById('tierModal').classList.remove('active');
            editingPlayerId = null;
        }

        function saveTierChange() {
            const newTier = parseInt(document.getElementById('tierModalInput').value);
            
            if (isNaN(newTier) || newTier < 1) {
                alert('Ìã∞Ïñ¥Îäî 1 Ïù¥ÏÉÅÏùò Ïà´ÏûêÏó¨Ïïº Ìï©ÎãàÎã§!');
                return;
            }

            const player = savedPlayers.find(p => p.id === editingPlayerId);
            if (player) {
                player.tier = newTier;
                saveCurrentTemplate();
                
                updatePlayerCardsEverywhere(player);
                
                updateSavedPlayersUI();
                updateTeamScores();
            }
            
            closeTierModal();
        }

        function updatePlayerCardsEverywhere(player) {
            const spectatorsGrid = document.getElementById('spectatorsGrid');
            const spectatorCards = spectatorsGrid.querySelectorAll('.spectator-card');
            spectatorCards.forEach(card => {
                const cardPlayer = JSON.parse(card.dataset.player);
                if (cardPlayer.id === player.id) {
                    cardPlayer.tier = player.tier;
                    card.dataset.player = JSON.stringify(cardPlayer);
                    card.querySelector('.tier-label').textContent = `${player.tier}Ï†ê`;
                }
            });

            const allSlots = document.querySelectorAll('.team-slot');
            allSlots.forEach(slot => {
                const card = slot.querySelector('.player-card');
                if (card) {
                    const cardPlayer = JSON.parse(card.dataset.player);
                    if (cardPlayer.id === player.id) {
                        cardPlayer.tier = player.tier;
                        card.dataset.player = JSON.stringify(cardPlayer);
                        card.querySelector('.tier-label').textContent = `${player.tier}Ï†ê`;
                    }
                }
            });
        }

        function selectPlayer(player) {
            const teamNames = getTeamPlayerNames();
            if (teamNames.has(player.name)) {
                alert(`${player.name}ÏùÄ(Îäî) Ïù¥ÎØ∏ ÌåÄÏóê Î∞∞ÏπòÎêòÏñ¥ ÏûàÏäµÎãàÎã§!`);
                return;
            }

            const spectatorNames = getSpectatorPlayerNames();
            if (spectatorNames.has(player.name)) {
                alert(`${player.name}ÏùÄ(Îäî) Ïù¥ÎØ∏ Í¥ÄÏ†ÑÏûêÏóê ÏûàÏäµÎãàÎã§!`);
                return;
            }
            
            addToSpectators(player);
            updateSpectatorCount();
            updateSavedPlayersUI();
            updateTeamSlots();
        }

        function updateSavedPlayersUI() {
            const container = document.getElementById('savedPlayers');
            container.innerHTML = '';

            if (savedPlayers.length === 0) {
                container.innerHTML = '<span style="color: #a0aec0;">Ï†ÄÏû•Îêú Ï∞∏Í∞ÄÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§</span>';
                return;
            }

            const teamNames = getTeamPlayerNames();
            const spectatorNames = getSpectatorPlayerNames();

            const sortedPlayers = [...savedPlayers].sort((a, b) => {
                return a.name.localeCompare(b.name, 'ko');
            });

            sortedPlayers.forEach(player => {
                const tag = document.createElement('div');
                tag.className = 'saved-player-tag';
                
                if (teamNames.has(player.name)) {
                    tag.classList.add('in-team');
                } else if (spectatorNames.has(player.name)) {
                    tag.classList.add('in-spectator');
                } else {
                    tag.classList.add('selectable');
                    tag.addEventListener('click', () => selectPlayer(player));
                }

                const contentDiv = document.createElement('div');
                contentDiv.style.display = 'flex';
                contentDiv.style.alignItems = 'center';
                contentDiv.style.gap = '8px';
                contentDiv.style.flex = '1';

                const nameSpan = document.createElement('span');
                nameSpan.textContent = player.name;

                const tierBadge = document.createElement('span');
                tierBadge.className = 'tier-badge';
                tierBadge.textContent = player.tier;
                tierBadge.title = 'ÌÅ¥Î¶≠ÌïòÏó¨ Ìã∞Ïñ¥ ÏàòÏ†ï';
                tierBadge.addEventListener('click', (e) => {
                    e.stopPropagation();
                    openTierModal(player);
                });

                contentDiv.appendChild(nameSpan);
                contentDiv.appendChild(tierBadge);

                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-btn';
                removeBtn.textContent = '‚úï';
                removeBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    removePlayer(player.id);
                });

                tag.appendChild(contentDiv);
                tag.appendChild(removeBtn);
                container.appendChild(tag);
            });
        }

        function updateTeamSlots() {
            const teamSize = calculateTeamSize();
            const team1 = document.getElementById('team1');
            const team2 = document.getElementById('team2');
            
            // ÌòÑÏû¨ ÌåÄÏóê ÏûàÎäî ÌîåÎ†àÏù¥Ïñ¥Îì§ Ï†ÄÏû•
            const team1Players = [];
            const team2Players = [];
            
            team1.querySelectorAll('.player-card').forEach(card => {
                team1Players.push(JSON.parse(card.dataset.player));
            });
            
            team2.querySelectorAll('.player-card').forEach(card => {
                team2Players.push(JSON.parse(card.dataset.player));
            });
            
            // Ïä¨Î°Ø Ïû¨ÏÉùÏÑ±
            team1.innerHTML = '';
            team2.innerHTML = '';
            
            for (let i = 0; i < teamSize; i++) {
                const slot1 = createSlot('team1', i);
                const slot2 = createSlot('team2', i);
                
                // Í∏∞Ï°¥ ÌîåÎ†àÏù¥Ïñ¥ Î≥µÏõê
                if (i < team1Players.length) {
                    slot1.innerHTML = '';
                    slot1.classList.remove('empty');
                    const card = createPlayerCard(team1Players[i]);
                    slot1.appendChild(card);
                }
                
                if (i < team2Players.length) {
                    slot2.innerHTML = '';
                    slot2.classList.remove('empty');
                    const card = createPlayerCard(team2Players[i]);
                    slot2.appendChild(card);
                }
                
                team1.appendChild(slot1);
                team2.appendChild(slot2);
            }

            updateTeamScores();
        }

        function createSlot(teamId, index) {
            const slot = document.createElement('div');
            slot.className = 'team-slot empty';
            slot.dataset.team = teamId;
            slot.dataset.index = index;
            
            slot.addEventListener('dragover', handleDragOver);
            slot.addEventListener('drop', handleDrop);
            slot.addEventListener('dragleave', handleDragLeave);
            slot.addEventListener('dragenter', handleDragEnter);
            
            return slot;
        }

        function createPlayerCard(player) {
            const card = document.createElement('div');
            card.className = 'player-card';
            card.innerHTML = `
                ${player.name}
                <div class="tier-label">${player.tier}Ï†ê</div>
                <div class="role-label">${ROLE_ICONS[player.role]} ${player.role}</div>
            `;
            card.draggable = true;
            card.dataset.player = JSON.stringify(player);
            
            card.addEventListener('dragstart', handleDragStart);
            card.addEventListener('dragend', handleDragEnd);
            
            return card;
        }

        function handleDragStart(e) {
            draggedElement = e.target;
            sourceContainer = e.target.parentElement;
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.target.innerHTML);
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            
            document.querySelectorAll('.team-slot').forEach(slot => {
                slot.classList.remove('drag-over');
            });
            
            document.getElementById('spectatorsGrid').classList.remove('drag-over');
            
            updateTeamScores();
            updateSpectatorCount();
            updateSavedPlayersUI();
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDragEnter(e) {
            if (e.currentTarget.classList.contains('team-slot')) {
                e.currentTarget.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            if (e.currentTarget.classList.contains('team-slot')) {
                e.currentTarget.classList.remove('drag-over');
            }
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            if (e.preventDefault) {
                e.preventDefault();
            }
            
            const targetSlot = e.currentTarget;
            targetSlot.classList.remove('drag-over');
            
            if (!draggedElement || !sourceContainer) {
                return false;
            }
            
            if (sourceContainer === targetSlot) {
                return false;
            }
            
            const player = JSON.parse(draggedElement.dataset.player);
            const existingCard = targetSlot.querySelector('.player-card');
            
            if (existingCard) {
                const existingPlayer = JSON.parse(existingCard.dataset.player);
                
                targetSlot.innerHTML = '';
                targetSlot.classList.remove('empty');
                
                if (sourceContainer.classList.contains('team-slot')) {
                    sourceContainer.innerHTML = '';
                    sourceContainer.classList.remove('empty');
                    const newCard2 = createPlayerCard(existingPlayer);
                    sourceContainer.appendChild(newCard2);
                } else if (sourceContainer.classList.contains('spectators-grid')) {
                    draggedElement.remove();
                    addToSpectators(existingPlayer);
                }
                
                const newCard1 = createPlayerCard(player);
                targetSlot.appendChild(newCard1);
                
            } else {
                if (sourceContainer.classList.contains('team-slot')) {
                    sourceContainer.innerHTML = '';
                    sourceContainer.classList.add('empty');
                } else if (sourceContainer.classList.contains('spectators-grid')) {
                    draggedElement.remove();
                }
                
                targetSlot.innerHTML = '';
                targetSlot.classList.remove('empty');
                const newCard = createPlayerCard(player);
                targetSlot.appendChild(newCard);
            }
            
            updateTeamScores();
            updateSpectatorCount();
            updateSavedPlayersUI();
            return false;
        }

        function updateTeamScores() {
            const team1Slots = document.querySelectorAll('#team1 .team-slot');
            const team2Slots = document.querySelectorAll('#team2 .team-slot');
            
            let team1Score = 0;
            let team2Score = 0;
            
            team1Slots.forEach(slot => {
                const card = slot.querySelector('.player-card');
                if (card) {
                    const player = JSON.parse(card.dataset.player);
                    team1Score += player.tier;
                }
            });
            
            team2Slots.forEach(slot => {
                const card = slot.querySelector('.player-card');
                if (card) {
                    const player = JSON.parse(card.dataset.player);
                    team2Score += player.tier;
                }
            });
            
            document.getElementById('team1Score').textContent = `${team1Score}Ï†ê`;
            document.getElementById('team2Score').textContent = `${team2Score}Ï†ê`;
            
            const diff = Math.abs(team1Score - team2Score);
            const diffElement = document.getElementById('scoreDiff');
            diffElement.textContent = `Ï†êÏàòÏ∞®: ${diff}`;
            
            if (diff <= 1) {
                diffElement.classList.add('balanced');
            } else {
                diffElement.classList.remove('balanced');
            }
        }

        function getSpectatorPlayers() {
            const spectatorsGrid = document.getElementById('spectatorsGrid');
            const cards = spectatorsGrid.querySelectorAll('.spectator-card');
            const players = [];
            
            cards.forEach(card => {
                players.push(JSON.parse(card.dataset.player));
            });
            
            return players;
        }

        function getRoleCounts(players) {
            const counts = { 'ÌÉ±Ïª§': 0, 'ÎîúÎü¨': 0, 'ÌûêÎü¨': 0, 'ÎûúÎç§': 0 };
            players.forEach(p => {
                counts[p.role]++;
            });
            return counts;
        }

        function balancedRandomAssign() {
            const spectatorPlayers = getSpectatorPlayers();
            
            if (spectatorPlayers.length === 0) {
                alert('Í¥ÄÏ†ÑÏûêÎ•º Î®ºÏ†Ä Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }

            if (spectatorPlayers.length < 2) {
                alert('ÏµúÏÜå 2Î™Ö Ïù¥ÏÉÅÏùò Í¥ÄÏ†ÑÏûêÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§!');
                return;
            }

            clearTeams();
            
            const teamSize = calculateTeamSize();
            updateTeamSlots();

            const maxPlayers = teamSize * 2;
            const playersToAssign = spectatorPlayers.slice(0, Math.min(spectatorPlayers.length, maxPlayers));
            const remainingSpectators = spectatorPlayers.slice(maxPlayers);

            let bestAssignment = null;
            let bestScore = Infinity;
            const attempts = 10000;

            for (let i = 0; i < attempts; i++) {
                const shuffled = [...playersToAssign].sort(() => Math.random() - 0.5);
                const team1 = shuffled.slice(0, teamSize);
                const team2 = shuffled.slice(teamSize, teamSize * 2);
                
                const team1TierScore = team1.reduce((sum, p) => sum + p.tier, 0);
                const team2TierScore = team2.reduce((sum, p) => sum + p.tier, 0);
                const tierDiff = Math.abs(team1TierScore - team2TierScore);
                
                const team1Roles = getRoleCounts(team1);
                const team2Roles = getRoleCounts(team2);
                let roleDiff = 0;
                Object.keys(team1Roles).forEach(role => {
                    roleDiff += Math.abs(team1Roles[role] - team2Roles[role]);
                });
                
                const totalScore = tierDiff + roleDiff * 10;
                
                if (totalScore < bestScore) {
                    bestScore = totalScore;
                    bestAssignment = shuffled;
                    
                    if (totalScore === 0) break;
                }
            }

            if (bestAssignment) {
                assignPlayersToTeams(bestAssignment, teamSize);
                
                const spectatorsGrid = document.getElementById('spectatorsGrid');
                spectatorsGrid.innerHTML = '';
                remainingSpectators.forEach(player => addToSpectators(player));
                updateSpectatorCount();
                updateSavedPlayersUI();
                
                const team1 = bestAssignment.slice(0, teamSize);
                const team2 = bestAssignment.slice(teamSize);
                const tierDiff = Math.abs(
                    team1.reduce((s, p) => s + p.tier, 0) - 
                    team2.reduce((s, p) => s + p.tier, 0)
                );
                
                if (bestScore === 0) {
                    setTimeout(() => alert('üéØ ÏôÑÎ≤ΩÌïú Î∞∏Îü∞Ïä§Î°ú ÌåÄÏù¥ Ìé∏ÏÑ±ÎêòÏóàÏäµÎãàÎã§! (Ìã∞Ïñ¥ + Ïó≠Ìï†)'), 100);
                } else if (tierDiff <= 1) {
                    setTimeout(() => alert(`‚öñÔ∏è ÏµúÏ†Å Î∞∏Îü∞Ïä§Î°ú ÌåÄÏù¥ Ìé∏ÏÑ±ÎêòÏóàÏäµÎãàÎã§! (Ï†êÏàòÏ∞®: ${tierDiff})`), 100);
                }
            }
        }

        function spectatorRandomAssign() {
            const spectatorPlayers = getSpectatorPlayers();
            
            if (spectatorPlayers.length === 0) {
                alert('Í¥ÄÏ†ÑÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§!');
                return;
            }

            const emptySlotCount = getEmptySlotCount();
            
            if (emptySlotCount === 0) {
                alert('ÌåÄÏóê Îπà ÏûêÎ¶¨Í∞Ä ÏóÜÏäµÎãàÎã§!');
                return;
            }

            const team1Slots = document.querySelectorAll('#team1 .team-slot');
            const team2Slots = document.querySelectorAll('#team2 .team-slot');
            
            let team1Current = [];
            let team2Current = [];
            
            team1Slots.forEach(slot => {
                const card = slot.querySelector('.player-card');
                if (card) {
                    team1Current.push(JSON.parse(card.dataset.player));
                }
            });
            
            team2Slots.forEach(slot => {
                const card = slot.querySelector('.player-card');
                if (card) {
                    team2Current.push(JSON.parse(card.dataset.player));
                }
            });

            const teamSize = calculateTeamSize();
            const playersToAssign = Math.min(spectatorPlayers.length, emptySlotCount);
            let bestAssignment = null;
            let bestScore = Infinity;
            const attempts = 10000;

            for (let i = 0; i < attempts; i++) {
                const shuffled = [...spectatorPlayers].sort(() => Math.random() - 0.5);
                const testPlayers = shuffled.slice(0, playersToAssign);
                
                let team1Test = [...team1Current];
                let team2Test = [...team2Current];
                
                for (let j = 0; j < testPlayers.length; j++) {
                    if (team1Test.length < teamSize) {
                        team1Test.push(testPlayers[j]);
                    } else if (team2Test.length < teamSize) {
                        team2Test.push(testPlayers[j]);
                    }
                }
                
                const team1TierScore = team1Test.reduce((sum, p) => sum + p.tier, 0);
                const team2TierScore = team2Test.reduce((sum, p) => sum + p.tier, 0);
                const tierDiff = Math.abs(team1TierScore - team2TierScore);
                
                const team1Roles = getRoleCounts(team1Test);
                const team2Roles = getRoleCounts(team2Test);
                let roleDiff = 0;
                Object.keys(team1Roles).forEach(role => {
                    roleDiff += Math.abs(team1Roles[role] - team2Roles[role]);
                });
                
                const totalScore = tierDiff + roleDiff * 10;
                
                if (totalScore < bestScore) {
                    bestScore = totalScore;
                    bestAssignment = testPlayers;
                    if (totalScore === 0) break;
                }
            }

            if (bestAssignment) {
                let playerIndex = 0;
                
                team1Slots.forEach(slot => {
                    if ((slot.classList.contains('empty') || !slot.querySelector('.player-card')) && playerIndex < bestAssignment.length) {
                        slot.innerHTML = '';
                        slot.classList.remove('empty');
                        const card = createPlayerCard(bestAssignment[playerIndex]);
                        slot.appendChild(card);
                        playerIndex++;
                    }
                });
                
                team2Slots.forEach(slot => {
                    if ((slot.classList.contains('empty') || !slot.querySelector('.player-card')) && playerIndex < bestAssignment.length) {
                        slot.innerHTML = '';
                        slot.classList.remove('empty');
                        const card = createPlayerCard(bestAssignment[playerIndex]);
                        slot.appendChild(card);
                        playerIndex++;
                    }
                });
                
                const spectatorsGrid = document.getElementById('spectatorsGrid');
                spectatorsGrid.innerHTML = '';
                
                for (let i = playerIndex; i < spectatorPlayers.length; i++) {
                    addToSpectators(spectatorPlayers[i]);
                }
                
                updateSpectatorCount();
                updateTeamScores();
                updateSavedPlayersUI();
            }
        }

        function startAuction() {
            const spectatorPlayers = getSpectatorPlayers();
            
            if (spectatorPlayers.length === 0) {
                alert('Í≤ΩÎß§Ìï† Í¥ÄÏ†ÑÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§!');
                return;
            }

            if (spectatorPlayers.length < 2) {
                alert('ÏµúÏÜå 2Î™Ö Ïù¥ÏÉÅÏùò Í¥ÄÏ†ÑÏûêÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§!');
                return;
            }

            const teamSize = calculateTeamSize();
            updateTeamSlots();

            auctionPlayers = [...spectatorPlayers].sort(() => Math.random() - 0.5);
            currentAuctionIndex = 0;
            currentBid = { team: null, amount: 0 };
            
            team1Points = 100;
            team2Points = 100;
            updateTeamPoints();
            
            showAuctionModal();
        }

        function showAuctionModal() {
            if (currentAuctionIndex >= auctionPlayers.length) {
                alert('Î™®Îì† ÏÑ†ÏàòÏùò Í≤ΩÎß§Í∞Ä ÎÅùÎÇ¨ÏäµÎãàÎã§!');
                closeAuction();
                return;
            }

            const player = auctionPlayers[currentAuctionIndex];
            
            document.getElementById('auctionPlayerName').textContent = player.name;
            document.getElementById('auctionPlayerTier').textContent = `${player.tier}Ï†ê`;
            document.getElementById('auctionPlayerRole').textContent = `${ROLE_ICONS[player.role]} ${player.role}`;
            
            // Í≤ΩÎß§ Ìè¨Ïù∏Ìä∏ ÏûÖÎ†• ÌïÑÎìú Ï¥àÍ∏∞Ìôî
            document.getElementById('auctionTeam1PointsInput').value = team1Points;
            document.getElementById('auctionTeam2PointsInput').value = team2Points;
            
            document.getElementById('auctionTeam1Points').textContent = `${team1Points}P`;
            document.getElementById('auctionTeam2Points').textContent = `${team2Points}P`;
            
            document.getElementById('team1BidInput').value = '';
            document.getElementById('team2BidInput').value = '';
            currentBid = { team: null, amount: 0 };
            updateCurrentBid();
            
            document.getElementById('team1BidBtn').disabled = team1Points === 0;
            document.getElementById('team2BidBtn').disabled = team2Points === 0;
            
            highlightCurrentAuctionPlayer();
            
            document.getElementById('auctionModal').classList.add('active');

            // ÌÉÄÏù¥Î®∏ ÏãúÏûë
            startAuctionTimer();

            // 1ÌåÄ ÏûÖÎ†• Î∞ïÏä§Ïóê Ìè¨Ïª§Ïä§
            setTimeout(() => {
                document.getElementById('team1BidInput').focus();
            }, 100);
        }

        function highlightCurrentAuctionPlayer() {
            const spectatorsGrid = document.getElementById('spectatorsGrid');
            const cards = spectatorsGrid.querySelectorAll('.spectator-card');
            
            cards.forEach((card, index) => {
                card.classList.remove('auction-current');
                if (index === currentAuctionIndex) {
                    card.classList.add('auction-current');
                }
            });
        }

        function placeBid(team) {
            const inputId = team === 1 ? 'team1BidInput' : 'team2BidInput';
            const bidAmount = parseInt(document.getElementById(inputId).value);
            const teamPoints = team === 1 ? team1Points : team2Points;
            
            if (isNaN(bidAmount) || bidAmount < 0) {
                alert('Ïò¨Î∞îÎ•∏ ÏûÖÏ∞∞Í∞ÄÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }
            
            if (bidAmount > teamPoints) {
                alert('Î≥¥Ïú† Ìè¨Ïù∏Ìä∏Î≥¥Îã§ ÎÜíÍ≤å ÏûÖÏ∞∞Ìï† Ïàò ÏóÜÏäµÎãàÎã§!');
                return;
            }
            
            if (bidAmount <= currentBid.amount) {
                alert(`ÌòÑÏû¨ ÏûÖÏ∞∞Í∞Ä(${currentBid.amount}P)Î≥¥Îã§ ÎÜíÍ≤å ÏûÖÏ∞∞Ìï¥Ïïº Ìï©ÎãàÎã§!`);
                return;
            }
            
            currentBid = { team, amount: bidAmount };
            updateCurrentBid();
            
            // ÌÉÄÏù¥Î®∏ Î¶¨ÏÖã
            resetAuctionTimer();
            
            // ÏÉÅÎåÄÌé∏ ÏûÖÎ†• Î∞ïÏä§Î°ú Ìè¨Ïª§Ïä§ Ïù¥Îèô
            const oppositeInputId = team === 1 ? 'team2BidInput' : 'team1BidInput';
            const oppositeInput = document.getElementById(oppositeInputId);
            oppositeInput.focus();
            oppositeInput.select();
        }

        function updateCurrentBid() {
            const bidElement = document.getElementById('auctionCurrentBid');
            
            document.getElementById('auctionTeam1').classList.remove('last-bid');
            document.getElementById('auctionTeam2').classList.remove('last-bid');
            
            if (currentBid.team === null) {
                bidElement.innerHTML = 'ÌòÑÏû¨ ÏûÖÏ∞∞Í∞Ä: <span class="auction-winner">ÏóÜÏùå</span>';
            } else {
                const teamName = currentBid.team === 1 ? '1ÌåÄ' : '2ÌåÄ';
                bidElement.innerHTML = `ÌòÑÏû¨ ÏûÖÏ∞∞Í∞Ä: <span class="auction-winner">${teamName} - ${currentBid.amount}P</span>`;
                
                if (currentBid.team === 1) {
                    document.getElementById('auctionTeam1').classList.add('last-bid');
                } else {
                    document.getElementById('auctionTeam2').classList.add('last-bid');
                }
            }
        }

        function passAuction() {
            if (currentBid.team !== null) {
                alert('Ïù¥ÎØ∏ ÏûÖÏ∞∞Ïù¥ ÏûàÏäµÎãàÎã§. Ïú†Ï∞∞Ìï† Ïàò ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            // ÌòÑÏû¨ ÏÑ†ÏàòÎ•º Îß® Îí§Î°ú Ïù¥Îèô
            const passedPlayer = auctionPlayers[currentAuctionIndex];
            auctionPlayers.splice(currentAuctionIndex, 1);
            auctionPlayers.push(passedPlayer);
            
            // ÌÉÄÏù¥Î®∏ Î¶¨ÏÖã
            resetAuctionTimer();
            
            // Îã§Ïùå ÏÑ†ÏàòÎ°ú ÏßÑÌñâ (Ïù∏Îç±Ïä§Îäî Í∑∏ÎåÄÎ°ú)
            if (currentAuctionIndex < auctionPlayers.length) {
                currentBid = { team: null, amount: 0 };
                showAuctionModal();
            } else {
                alert('Î™®Îì† ÏÑ†ÏàòÏùò Í≤ΩÎß§Í∞Ä ÎÅùÎÇ¨ÏäµÎãàÎã§!');
                closeAuction();
            }
        }

        function nextAuctionPlayer() {
            if (currentBid.team === null) {
                if (team1Points === 0 && team2Points > 0) {
                    currentBid = { team: 2, amount: 0 };
                } else if (team2Points === 0 && team1Points > 0) {
                    currentBid = { team: 1, amount: 0 };
                } else {
                    alert('ÏïÑÏßÅ ÏûÖÏ∞∞Ïù¥ ÏóÜÏäµÎãàÎã§!');
                    return;
                }
            }
            
            const player = auctionPlayers[currentAuctionIndex];
            const team = currentBid.team;
            const amount = currentBid.amount;
            
            if (team === 1) {
                team1Points -= amount;
            } else {
                team2Points -= amount;
            }
            updateTeamPoints();
            
            addPlayerToTeam(player, team);
            removeFromSpectators(player);
            
            currentAuctionIndex++;
            
            // ÌÉÄÏù¥Î®∏ Î¶¨ÏÖã
            resetAuctionTimer();
            
            if (currentAuctionIndex < auctionPlayers.length) {
                if (team1Points === 0 || team2Points === 0) {
                    stopAuctionTimer();
                    autoAssignRemaining();
                } else {
                    showAuctionModal();
                }
            } else {
                stopAuctionTimer();
                alert('üéâ Í≤ΩÎß§Í∞Ä Ï¢ÖÎ£åÎêòÏóàÏäµÎãàÎã§!');
                closeAuction();
            }
        }

        function autoAssignRemaining() {
            const remainingPlayers = auctionPlayers.slice(currentAuctionIndex);
            const targetTeam = team1Points === 0 ? 2 : 1;
            
            remainingPlayers.forEach(player => {
                addPlayerToTeam(player, targetTeam);
                removeFromSpectators(player);
            });
            
            alert(`üéâ Í≤ΩÎß§Í∞Ä Ï¢ÖÎ£åÎêòÏóàÏäµÎãàÎã§! ÎÇ®ÏùÄ ÏÑ†ÏàòÎäî ${targetTeam}ÌåÄÏóê ÏûêÎèô Î∞∞Ï†ïÎêòÏóàÏäµÎãàÎã§.`);
            closeAuction();
        }

        function addPlayerToTeam(player, team) {
            const teamSlots = team === 1 ? 
                document.querySelectorAll('#team1 .team-slot') : 
                document.querySelectorAll('#team2 .team-slot');
            
            for (let slot of teamSlots) {
                if (slot.classList.contains('empty') || !slot.querySelector('.player-card')) {
                    slot.innerHTML = '';
                    slot.classList.remove('empty');
                    const card = createPlayerCard(player);
                    slot.appendChild(card);
                    break;
                }
            }
            
            updateTeamScores();
            updateSavedPlayersUI();
        }

        function closeAuction() {
            // ÌÉÄÏù¥Î®∏ Ï§ëÏßÄ
            stopAuctionTimer();
            
            document.getElementById('auctionModal').classList.remove('active');
            
            const cards = document.querySelectorAll('.spectator-card');
            cards.forEach(card => card.classList.remove('auction-current'));
            
            document.getElementById('auctionTeam1').classList.remove('last-bid');
            document.getElementById('auctionTeam2').classList.remove('last-bid');
        }

        function assignPlayersToTeams(players, teamSize) {
            const team1Slots = document.querySelectorAll('#team1 .team-slot');
            const team2Slots = document.querySelectorAll('#team2 .team-slot');
            
            let index = 0;
            
            for (let i = 0; i < teamSize && index < players.length; i++) {
                team1Slots[i].innerHTML = '';
                team1Slots[i].classList.remove('empty');
                const card = createPlayerCard(players[index]);
                team1Slots[i].appendChild(card);
                index++;
            }
            
            for (let i = 0; i < teamSize && index < players.length; i++) {
                team2Slots[i].innerHTML = '';
                team2Slots[i].classList.remove('empty');
                const card = createPlayerCard(players[index]);
                team2Slots[i].appendChild(card);
                index++;
            }
            
            updateTeamScores();
        }

        function clearTeams() {
            const team1Slots = document.querySelectorAll('#team1 .team-slot');
            const team2Slots = document.querySelectorAll('#team2 .team-slot');
            
            [...team1Slots, ...team2Slots].forEach(slot => {
                slot.innerHTML = '';
                slot.classList.add('empty');
            });
            
            updateTeamScores();
        }

        function clearAll() {
            clearTeams();
            
            const spectatorsGrid = document.getElementById('spectatorsGrid');
            spectatorsGrid.innerHTML = '';
            
            team1Points = 100;
            team2Points = 100;
            updateTeamPoints();
            
            updateSpectatorCount();
            updateSavedPlayersUI();
            updateTeamSlots();
        }


        init();
    </script>
</body>
</html>
